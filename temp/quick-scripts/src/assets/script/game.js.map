{"version":3,"sources":["assets\\script\\game.js"],"names":["cc","Class","Component","properties","rope_node","type","Node","cow_ins","rope_imgs","SpriteFrame","cow_prefab","Prefab","onLoad","success","scoreNum","start","countDownLabel","find","getComponent","Label","time","schedule","string","log","resultNode","titleNode","getChildByName","contentNode","contentLabel","active","director","pause","sysInfo","wx","getSystemInfoSync","screenWidth","screenHeight","wxLoginBtn","createUserInfoButton","text","style","left","top","width","height","lineHeight","backgroundColor","color","self","onTap","res","console","userInfo","wxLogin","destroy","getUserInfo","fail","icon","Sprite","loader","load","url","avatarUrl","err","texture","spriteFrame","login","code","httpUtils","request","method","data","nickName","msg","errMsg","clickCapture","event","customEventDate","setSiblingIndex","y","up","moveTo","x","result","callFunc","currentX","bgNode","node","removeChild","ropeType","randomType","instantiate","addChild","down","finish","scoreLabel","sequence","runAction","closeBtn","resume","loadScene","shareBtn","shareAppMessage","title","imageUrl"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        rope_node:{\r\n            default : null,\r\n            type : cc.Node\r\n        },\r\n        cow_ins:{\r\n            default: null,\r\n            type:cc.Node\r\n        },\r\n        rope_imgs:{\r\n            default:[],\r\n            type:cc.SpriteFrame\r\n        },\r\n\r\n        //再绑定一个预制体\r\n        cow_prefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        }\r\n\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.success=false;\r\n\r\n        //初始化分数\r\n        this.scoreNum=0;\r\n    },\r\n\r\n    start () {\r\n        let countDownLabel=cc.find(\"Canvas/bg-Sprite/count_down\").getComponent(cc.Label);\r\n        let time=30;\r\n        this.schedule(function(){\r\n            time--;\r\n            countDownLabel.string=time+\"s\";\r\n\r\n            if(time==0){\r\n                cc.log(\"游戏结束！\");\r\n                //获取弹窗节点\r\n                let resultNode=cc.find(\"Canvas/result\");\r\n                //获取title和content两个节点\r\n                let titleNode=resultNode.getChildByName(\"title\");\r\n                let contentNode=resultNode.getChildByName(\"content\");\r\n                //展示分数\r\n                titleNode.getComponent(cc.Label).string=\"最终得分：\"+this.scoreNum;\r\n\r\n                //获取组件\r\n                let contentLabel=contentNode.getComponent(cc.Label);\r\n                switch(true){\r\n                    case this.scoreNum<=3:\r\n                        contentLabel.string=\"套牛青铜\";\r\n                        break;\r\n                    case this.scoreNum<=6:\r\n                        contentLabel.string=\"套牛高手\";\r\n                        break;\r\n                    case this.scoreNum>6:\r\n                        contentLabel.string=\"套牛王者\";\r\n                        break;\r\n                }\r\n\r\n                resultNode.active=true;\r\n                cc.director.pause();\r\n            }\r\n        },1);\r\n\r\n\r\n\r\n        //创建一个用户授权按钮\r\n        let sysInfo = wx.getSystemInfoSync();\r\n        //获取微信界面大小\r\n        let screenWidth = sysInfo.screenWidth;\r\n        let screenHeight = sysInfo.screenHeight;\r\n\r\n        // 创建一个用户授权按钮\r\n        const wxLoginBtn = wx.createUserInfoButton({\r\n            type:\"text\",\r\n            text:\"\",\r\n            style:{\r\n                left:0,\r\n                top:0,\r\n                width:screenWidth,\r\n                height:screenHeight,\r\n                lineHeight:40,\r\n                backgroundColor: '#00000000',\r\n                color: '#ffffff',\r\n                /*textAlign:'center',\r\n                fontSize:16,\r\n                borderRadius:4*/\r\n            }\r\n        });\r\n\r\n        let self=this;\r\n\r\n        wxLoginBtn.onTap((res)=>{\r\n            console.log(res.userInfo);\r\n            //拿到微信用户信息\r\n            let userInfo=res.userInfo;\r\n            self.wxLogin(userInfo);\r\n            wxLoginBtn.destroy();\r\n            /*\r\n            let icon=cc.find(\"Canvas/bg-Sprite/icon\").getComponent(cc.Sprite);\r\n            //加载远程网络图片\r\n            cc.loader.load({url:userInfo.axatarUrl,type:\"png\"},function (err,texture){\r\n                icon.spriteFrame=new cc.SpriteFrame(texture);\r\n            })*/\r\n        });\r\n\r\n        wx.getUserInfo({\r\n            success(res){\r\n                let userInfo = res.userInfo;\r\n                self.wxLogin(userInfo);\r\n            },\r\n            fail(){\r\n                console.log(\"获取失败\");\r\n            }\r\n        })\r\n\r\n    },\r\n\r\n    wxLogin(userInfo) {\r\n\r\n        let icon = cc.find(\"Canvas/bg-Sprite/icon\").getComponent(cc.Sprite);\r\n        // 加载远程网络图片\r\n        cc.loader.load({url:userInfo.avatarUrl,type:\"png\"},function (err,texture) {\r\n            icon.spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n\r\n        wx.login({\r\n            success(res) {\r\n                if (res.code) {\r\n                    // 发起网络请求给游戏后台\r\n                    httpUtils.request({\r\n                        url:\"http://localhost:8080/login\",\r\n                        method: \"POST\",\r\n                        data:{\r\n                            code:res.code,\r\n                            nickName:userInfo.nickName,\r\n                            avatarUrl:userInfo.avatarUrl\r\n                        },\r\n                        success(msg) {\r\n                            console.log(msg);\r\n                        }\r\n                    })\r\n                    /*    wx.request({\r\n                            url:\"http://localhost:8080/login\",\r\n                            method: \"POST\",\r\n                            header:{\r\n                                'content-type':'application/x-www-form-urlencoded'\r\n                            },\r\n                            data:{\r\n                                code:res.code,\r\n                                nickName:userInfo.nickName,\r\n                                avatarUrl:userInfo.avatarUrl\r\n                            }\r\n                        })*/\r\n                } else {\r\n                    console.log(\"登录失败\"+ res.errMsg);\r\n                }\r\n            }\r\n        })\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n\r\n    //点击事件捕捉函数\r\n    clickCapture:function (event,customEventDate){\r\n        this.rope_node.active=true;\r\n        //设置绳子在当前父节点的顺序\r\n        this.rope_node.setSiblingIndex(100);\r\n\r\n        //设置绳子的起始位置\r\n        this.rope_node.y=-500;\r\n        //向上移动\r\n        const up=cc.moveTo(0.4,this.rope_node.x,0);\r\n\r\n\r\n        //判定结果\r\n        let result=cc.callFunc(function(){\r\n            //获取当前牛儿的x点\r\n            let currentX=this.cow_ins.x;\r\n            if(currentX>-80&&currentX<80){\r\n                cc.log(\"捕捉成功！\");\r\n\r\n                //移除\r\n                let bgNode = this.node.getChildByName(\"bg-Sprite\");\r\n                bgNode.removeChild(this.cow_ins);\r\n\r\n                //更换绳子,获取牛儿的类型\r\n                let ropeType=this.cow_ins.getComponent(\"cow\").randomType+1;\r\n                this.rope_node.getComponent(cc.Sprite).spriteFrame=this.rope_imgs[ropeType];\r\n\r\n\r\n                //生成新的牛节点\r\n                this.cow_ins=cc.instantiate(this.cow_prefab);\r\n                this.cow_ins.y=0;\r\n                bgNode.addChild(this.cow_ins);\r\n\r\n                this.success=true;\r\n                //分数加一\r\n                this.scoreNum++;\r\n            }\r\n            else{\r\n                cc.log(\"捕捉失败！\");\r\n            }\r\n        },this);\r\n\r\n        //往回拉\r\n        let down=cc.moveTo(0.5,this.rope_node.x,-500);\r\n\r\n        let finish=cc.callFunc(function (){\r\n            this.rope_node.getComponent(cc.Sprite).spriteFrame=this.rope_imgs[0];\r\n            //判断是否捕捉成功\r\n            if(this.success==true){\r\n                let scoreLabel=cc.find(\"Canvas/bg-Sprite/score\").getComponent(cc.Label);\r\n                scoreLabel.string=\"Score:\"+this.scoreNum;\r\n                this.success=false;\r\n            }\r\n        },this);\r\n\r\n\r\n\r\n        //定义一个序列动画\r\n        let sequence=cc.sequence(up,result,down,finish);\r\n\r\n        this.rope_node.runAction(sequence);\r\n    },\r\n\r\n    //关闭按钮，继续游戏\r\n    closeBtn(){\r\n        cc.log(\"继续游戏\");\r\n        cc.director.resume();//删除逻辑\r\n        cc.director.loadScene(\"game\");//重新加载\r\n    },\r\n\r\n\r\n    //微信分享\r\n    shareBtn(){\r\n        wx.shareAppMessage({\r\n            title:\"大家都来玩套牛小游戏\",\r\n            imageUrl:\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg3.redocn.com%2F20091201%2F20091201_36a55ccc6625c6ee296buiktEBtACmVW.jpg&refer=http%3A%2F%2Fimg3.redocn.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1625222968&t=b683e51e94e88873f13821202827ac80\",\r\n            success(res){\r\n                console.log(res);\r\n            },\r\n            fail(res){\r\n                console.log(res);\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n});\r\n"]}